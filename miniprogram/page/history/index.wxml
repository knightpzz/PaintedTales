<view class="custom-nav">
  <image class="back-icon" src="../../image/wechat.png" bindtap="goBack"></image>
  <text class="nav-title">å†å²è®°å½•</text>
</view>
<!-- ğŸ” æœç´¢æ  -->
<view class="search-bar">
  <input class="search-input" placeholder="è¯·è¾“å…¥å…³é”®è¯æœç´¢"
         bindinput="onSearchInput"
         confirm-type="search"
         bindconfirm="onSearchConfirm"
         value="{{searchKeyword}}" />
  <button class="search-btn" bindtap="onSearchConfirm">æœç´¢</button>
</view>

<scroll-view scroll-y="true" style="height: 100vh;">
  <view class="history-page">

    <block wx:for="{{historyList}}" wx:key="id">
      <view class="history-item">
        <text>å…³é”®è¯ï¼š{{item.inputText}}</text>

        <!-- âœ… æ–°å¢æè¿°ä¿¡æ¯æ˜¾ç¤º -->
        <view class="description-block">
          <text class="desc-text" wx:if="{{!item.showFullDescription}}">
            {{item.descriptionPreview}}
          </text>

          <view wx:elif="{{item.showFullDescription}}">
            <block wx:for="{{item.description}}" wx:key="*this">
              <text class="desc-line">Â· {{item}}</text>
            </block>
          </view>

          <text class="toggle-btn" data-index="{{index}}" bindtap="toggleDescription">
            {{item.showFullDescription ? 'æ”¶èµ·' : 'å±•å¼€'}}
          </text>
        </view>




        <!-- åˆ¤æ–­è®°å½•ç±»å‹ï¼šå›¾ç‰‡æˆ–è§†é¢‘ -->
        <view wx:if="{{item.type === 'image'}}">
          <swiper class="swiper" indicator-dots circular autoplay>
            <block wx:for="{{item.images}}" wx:key="*this">
              <swiper-item>
                <image src="{{item}}" mode="aspectFill" class="image" />

              </swiper-item>
            </block>
          </swiper>
          <!-- æ‰¹é‡ä¸‹è½½å›¾ç‰‡-->
          <button bindtap="downloadAllImages" data-item="{{item}}" class="download-btn">ä¸‹è½½å›¾ç‰‡</button>
        </view>

        <view wx:elif="{{item.type === 'video'}}">
          <video src="{{item.videoUrl}}" controls class="video-player" initial-time="0" autoplay="false" loop="false"></video>
          <!-- æ·»åŠ ä¸‹è½½è§†é¢‘æŒ‰é’® -->
           <button bindtap="downloadVideo" data-url="{{item.videoUrl}}" class="download-btn">ä¸‹è½½è§†é¢‘</button>
        </view>


        <view class="history-footer">
          <text class="timestamp">ç”Ÿæˆæ—¶é—´ï¼š{{item.createdAt}}</text>
          <!-- æ”¶è—æŒ‰é’® -->
          <image class="favor-btn" src="../../image/{{item.isFavor ? 'favor-filled' : 'favor'}}.png" data-id="{{item._id}}" bindtap="onToggleFavor" />


          <image class="delete-icon" src="../../image/trash.png" data-id="{{item._id}}" bindtap="onDeleteConfirm" />
        </view>

      </view>
    </block>

  </view>
  <view class="bottom-gap" style="height: 100rpx;"></view>
</scroll-view>